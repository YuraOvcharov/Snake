let canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d");const width=500,height=500;let score=0,checkCollisionIndicator=!0;canvas.width=500,canvas.height=500;const blockSize=10;let widthInBlocks=500/blockSize,heightInBlocks=500/blockSize,drawBorder=function(){ctx.fillStyle="Gray",ctx.fillRect(0,0,500,blockSize),ctx.fillRect(0,500-blockSize,500,blockSize),ctx.fillRect(0,0,blockSize,500),ctx.fillRect(500-blockSize,0,blockSize,500)},drawScore=function(){ctx.font="20px Courier",ctx.fillStyle="Black",ctx.textAlign="left",ctx.textBaseline="top",ctx.fillText("Счет: "+score,blockSize,blockSize)},gameOver=()=>{clearTimeout(timeoutId),ctx.font="30px Courier",ctx.fillStyle="Black",ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillText("Конец игры",250,250)},circle=(e,t,i,o)=>{ctx.beginPath(),ctx.arc(e,t,i,0,2*Math.PI),o?ctx.fill():ctx.stroke()};class Block{constructor(e,t){this.col=e,this.row=t}drawSquare(e){let t=this.col*blockSize,i=this.row*blockSize;ctx.fillStyle=e,ctx.fillRect(t,i,blockSize,blockSize)}drawCircle(e){let t=this.col*blockSize+blockSize/2,i=this.row*blockSize+blockSize/2;ctx.fillStyle=e,circle(t,i,blockSize/2,!0)}equal(e){return this.col===e.col&&this.row===e.row}}class Snake{constructor(){this.segments=[new Block(3,1),new Block(2,1),new Block(1,1)],this.direction="right",this.nextDirection="right"}draw(){this.segments[0].drawSquare("Red");for(let e=1;e<this.segments.length;e++)e%2?this.segments[e].drawSquare("yellow"):this.segments[e].drawSquare("blue")}move(){let e,t=this.segments[0];this.direction=this.nextDirection,"right"==this.direction?e=new Block(t.col+1,t.row):"down"==this.direction?e=new Block(t.col,t.row+1):"left"==this.direction?e=new Block(t.col-1,t.row):"up"==this.direction&&(e=new Block(t.col,t.row-1)),this.checkCollision(e)?checkCollisionIndicator=!1:(this.segments.unshift(e),e.equal(apple.position)?(score+=1,apple.move()):this.segments.pop())}checkCollision(e){let t=0===e.col,i=0===e.row,o=e.col===widthInBlocks-1,l=e.row===heightInBlocks-1,c=t||i||o||l,n=!1;for(let t of this.segments)e.equal(t)&&(n=!0);return c||n}setDirection(e){"up"===this.direction&&"down"===e||"right"===this.direction&&"left"===e||"down"===this.direction&&"up"===e||"left"===this.direction&&"right"===e||(this.nextDirection=e)}}class Apple{constructor(){this.position=new Block(widthInBlocks/2,heightInBlocks/2)}draw(){this.position.drawCircle("LimeGreen")}move(){let e=Math.floor(Math.random()*(widthInBlocks-2)+1),t=Math.floor(Math.random()*(heightInBlocks-2)+1),i=0;for(;i<snake.segments.length;)snake.segments[i].col===e&&snake.segments[i].row===t?(e=Math.floor(Math.random()*(widthInBlocks-2)+1),t=Math.floor(Math.random()*(heightInBlocks-2)+1),i=0):i+=1;this.position=new Block(e,t)}}let snake=new Snake,apple=new Apple,direction={37:"left",38:"up",39:"right",40:"down"};$("body").keydown(function(e){let t=direction[e.keyCode];void 0!==t&&snake.setDirection(t)});let animationTime=100,levelOfComplexity=2*score,timeoutId=setTimeout(function e(){ctx.clearRect(0,0,500,500),drawScore(),snake.move(),snake.draw(),apple.draw(),drawBorder(),checkCollisionIndicator?setTimeout(e,animationTime-levelOfComplexity):gameOver()},100);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiY2FudmFzIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImN0eCIsImdldENvbnRleHQiLCJ3aWR0aCIsImhlaWdodCIsInNjb3JlIiwiY2hlY2tDb2xsaXNpb25JbmRpY2F0b3IiLCJibG9ja1NpemUiLCJ3aWR0aEluQmxvY2tzIiwiaGVpZ2h0SW5CbG9ja3MiLCJkcmF3Qm9yZGVyIiwiZmlsbFN0eWxlIiwiZmlsbFJlY3QiLCJkcmF3U2NvcmUiLCJmb250IiwidGV4dEFsaWduIiwidGV4dEJhc2VsaW5lIiwiZmlsbFRleHQiLCJnYW1lT3ZlciIsImNsZWFyVGltZW91dCIsInRpbWVvdXRJZCIsImNpcmNsZSIsIngiLCJ5IiwicmFkaXVzIiwiZmlsbENpcmNsZSIsImJlZ2luUGF0aCIsImFyYyIsIk1hdGgiLCJQSSIsImZpbGwiLCJzdHJva2UiLCJCbG9jayIsIltvYmplY3QgT2JqZWN0XSIsImNvbCIsInJvdyIsInRoaXMiLCJjb2xvciIsImNlbnRlclgiLCJjZW50ZXJZIiwib3RoZXJCbG9jayIsIlNuYWtlIiwic2VnbWVudHMiLCJkaXJlY3Rpb24iLCJuZXh0RGlyZWN0aW9uIiwiZHJhd1NxdWFyZSIsImkiLCJsZW5ndGgiLCJuZXdIZWFkIiwiaGVhZCIsImNoZWNrQ29sbGlzaW9uIiwidW5zaGlmdCIsImVxdWFsIiwiYXBwbGUiLCJwb3NpdGlvbiIsIm1vdmUiLCJwb3AiLCJsZWZ0Q29sbGlzaW9uIiwidG9wdENvbGxpc2lvbiIsInJpZ2h0dENvbGxpc2lvbiIsImJvdHRvbUNvbGxpc2lvbiIsIndhbGxDb2xsaXNpb24iLCJzZWxmQ29sbGlzaW9uIiwic2VnIiwibmV3RGlyZWN0aW9uIiwiQXBwbGUiLCJkcmF3Q2lyY2xlIiwicmFuZG9tQ29sIiwiZmxvb3IiLCJyYW5kb20iLCJyYW5kb21Sb3ciLCJzbmFrZSIsIjM3IiwiMzgiLCIzOSIsIjQwIiwiJCIsImtleWRvd24iLCJldmVudCIsImtleUNvZGUiLCJ1bmRlZmluZWQiLCJzZXREaXJlY3Rpb24iLCJhbmltYXRpb25UaW1lIiwibGV2ZWxPZkNvbXBsZXhpdHkiLCJzZXRUaW1lb3V0IiwiZ2FtZUxvb3AiLCJjbGVhclJlY3QiLCJkcmF3Il0sIm1hcHBpbmdzIjoiQUFDQSxJQUFJQSxPQUFTQyxTQUFTQyxlQUFlLFVBQ2pDQyxJQUFNSCxPQUFPSSxXQUFXLE1BRTVCLE1BQU1DLE1BQVEsSUFDUkMsT0FBUSxJQUNkLElBQUlDLE1BQVEsRUFDUkMseUJBQTBCLEVBSTlCUixPQUFPSyxNQVBPLElBUWRMLE9BQU9NLE9BUE8sSUFVZCxNQUFNRyxVQUFZLEdBQ2xCLElBQUlDLGNBWlUsSUFZY0QsVUFDeEJFLGVBWlUsSUFZZ0JGLFVBSTFCRyxXQUFhLFdBQ2JULElBQUlVLFVBQVksT0FDaEJWLElBQUlXLFNBQVMsRUFBRSxFQW5CTCxJQW1CYUwsV0FDdkJOLElBQUlXLFNBQVMsRUFuQkgsSUFtQmNMLFVBcEJkLElBb0I4QkEsV0FDeENOLElBQUlXLFNBQVMsRUFBRSxFQUFFTCxVQXBCUCxLQXFCVk4sSUFBSVcsU0F0Qk0sSUFzQldMLFVBQVUsRUFBRUEsVUFyQnZCLE1Bd0JWTSxVQUFZLFdBQ1paLElBQUlhLEtBQU8sZUFDWGIsSUFBSVUsVUFBWSxRQUNoQlYsSUFBSWMsVUFBWSxPQUNoQmQsSUFBSWUsYUFBZSxNQUNuQmYsSUFBSWdCLFNBQVMsU0FBVVosTUFBTUUsVUFBVUEsWUFHdkNXLFNBQVcsS0FHWEMsYUFBYUMsV0FDYm5CLElBQUlhLEtBQU8sZUFDWGIsSUFBSVUsVUFBWSxRQUNoQlYsSUFBSWMsVUFBWSxTQUNoQmQsSUFBSWUsYUFBZSxTQUNuQmYsSUFBSWdCLFNBQVMsYUFBY2QsSUFBV0MsTUFJdENpQixPQUFTLENBQUNDLEVBQUVDLEVBQUVDLEVBQU9DLEtBQ3JCeEIsSUFBSXlCLFlBQ0p6QixJQUFJMEIsSUFBSUwsRUFBRUMsRUFBRUMsRUFBTyxFQUFVLEVBQVJJLEtBQUtDLElBQ3RCSixFQUNBeEIsSUFBSTZCLE9BRUo3QixJQUFJOEIsVUFLWixN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RCxlQUFpQixHQUFLLEdBQzdEcUMsRUFBSSxFQUNSLEtBQU1BLEVBQUl5QixNQUFNN0IsU0FBU0ssUUFDakJ3QixNQUFNN0IsU0FBU0ksR0FBR1osTUFBUWlDLEdBQWFJLE1BQU03QixTQUFTSSxHQUFHWCxNQUFRbUMsR0FDakVILEVBQVl2QyxLQUFLd0MsTUFBTXhDLEtBQUt5QyxVQUFZN0QsY0FBZ0IsR0FBSyxHQUM3RDhELEVBQVkxQyxLQUFLd0MsTUFBTXhDLEtBQUt5QyxVQUFXNUQsZUFBaUIsR0FBSyxHQUM3RHFDLEVBQUksR0FFSkEsR0FBSyxFQUdiVixLQUFLa0IsU0FBWSxJQUFJdEIsTUFBT21DLEVBQVVHLElBSTlDLElBQUlDLE1BQVEsSUFBSTlCLE1BQ1pZLE1BQVEsSUFBSVksTUFFWnRCLFVBQVksQ0FDWDZCLEdBQUksT0FDSkMsR0FBSSxLQUNKQyxHQUFJLFFBQ0pDLEdBQUksUUFHUkMsRUFBRSxRQUFRQyxRQUFRLFNBQVNDLEdBQ3ZCLElBQUlkLEVBQWVyQixVQUFVbUMsRUFBTUMsY0FFZEMsSUFBakJoQixHQUNBTyxNQUFNVSxhQUFhakIsS0FlNUIsSUFBSWtCLGNBQWdCLElBQ2hCQyxrQkFBNEIsRUFBUjlFLE1BRXBCZSxVQUFZZ0UsV0FBVyxTQUFTQyxJQUNoQ3BGLElBQUlxRixVQUFVLEVBQUUsRUF2T04sSUFDQSxLQXVPVnpFLFlBQ0EwRCxNQUFNaEIsT0FDTmdCLE1BQU1nQixPQUNObEMsTUFBTWtDLE9BQ043RSxhQUNJSix3QkFFQThFLFdBQVdDLEVBQVNILGNBQWNDLG1CQUVsQ2pFLFlBR04iLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8v0L3QsNGB0YLRgNC+0LnQutCwINGF0L7Qu9GB0YLQsFxyXG5sZXQgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjYW52YXNcIik7XHJcbmxldCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xyXG5cclxuY29uc3Qgd2lkdGggPSA1MDA7Ly9jYW52YXMud2lkdGg7XHJcbmNvbnN0IGhlaWdodCA9NTAwOy8vY2FudmFzLmhlaWdodDtcclxubGV0IHNjb3JlID0gMDtcclxubGV0IGNoZWNrQ29sbGlzaW9uSW5kaWNhdG9yID0gdHJ1ZTsgLy8g0LTQu9GPINGC0L7Qs9C+LCDRh9GC0L7QsdGLINC/0YDQuCDRgNC10LrRg9GA0YHQuNCy0L3QvtC8INCy0YvQt9C+0LLQtVxyXG4vL3NldFRpbWVvdXQg0LLRi9C50YLQuC5cclxuXHJcblxyXG5jYW52YXMud2lkdGggPSB3aWR0aDtcclxuY2FudmFzLmhlaWdodCA9IGhlaWdodDtcclxuXHJcbi8v0LLRi9GH0LjRgdC70Y/QtdC8INGI0LjRgNC40L3RgyDQuCDQstGL0YHQvtGC0YMg0Y/Rh9C10LnQutC4XHJcbmNvbnN0IGJsb2NrU2l6ZSA9IDEwO1xyXG5sZXQgd2lkdGhJbkJsb2NrcyA9IHdpZHRoIC8gYmxvY2tTaXplO1xyXG5sZXQgaGVpZ2h0SW5CbG9ja3MgPSBoZWlnaHQgLyBibG9ja1NpemU7XHJcblxyXG5cclxuLy/RgNC40YHRg9C10Lwg0YDQsNC80LrRg1xyXG5sZXQgZHJhd0JvcmRlciA9IGZ1bmN0aW9uKCl7XHJcbiAgICBjdHguZmlsbFN0eWxlID0gXCJHcmF5XCI7XHJcbiAgICBjdHguZmlsbFJlY3QoMCwwLHdpZHRoLGJsb2NrU2l6ZSk7Ly/QstC10YDRhVxyXG4gICAgY3R4LmZpbGxSZWN0KDAsaGVpZ2h0IC0gYmxvY2tTaXplLHdpZHRoLGJsb2NrU2l6ZSk7Ly/QvdC40LdcclxuICAgIGN0eC5maWxsUmVjdCgwLDAsYmxvY2tTaXplLGhlaWdodCk7Ly/Qu9C10LLQvlxyXG4gICAgY3R4LmZpbGxSZWN0KHdpZHRoIC0gYmxvY2tTaXplLDAsYmxvY2tTaXplLCBoZWlnaHQpOy8v0L/RgNCw0LLQvlxyXG59O1xyXG4vL9CS0YvQstC+0LTQuNC8INGB0YfQtdGCXHJcbmxldCBkcmF3U2NvcmUgPSBmdW5jdGlvbiAoKXtcclxuICAgIGN0eC5mb250ID0gXCIyMHB4IENvdXJpZXJcIjtcclxuICAgIGN0eC5maWxsU3R5bGUgPSBcIkJsYWNrXCI7XHJcbiAgICBjdHgudGV4dEFsaWduID0gXCJsZWZ0XCI7XHJcbiAgICBjdHgudGV4dEJhc2VsaW5lID0gXCJ0b3BcIjtcclxuICAgIGN0eC5maWxsVGV4dChcItCh0YfQtdGCOiBcIisgc2NvcmUsYmxvY2tTaXplLGJsb2NrU2l6ZSk7XHJcbn07XHJcbi8vINCa0L7QvdC10YYg0LjQs9GA0YtcclxubGV0IGdhbWVPdmVyID0gKCk9PntcclxuICAgIC8vY2xlYXJJbnRlcnZhbChpbnRlcnZhbElkKTsvL9C+0YHRgtCw0L3QvtCy0LrQsCDRgdGH0LXRgtGH0LjQutCwINC00LvRjyBzZXRJbnRlcnZhbFxyXG5cclxuICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SWQpO1xyXG4gICAgY3R4LmZvbnQgPSBcIjMwcHggQ291cmllclwiO1xyXG4gICAgY3R4LmZpbGxTdHlsZSA9IFwiQmxhY2tcIjtcclxuICAgIGN0eC50ZXh0QWxpZ24gPSBcImNlbnRlclwiO1xyXG4gICAgY3R4LnRleHRCYXNlbGluZSA9IFwibWlkZGxlXCI7XHJcbiAgICBjdHguZmlsbFRleHQoXCLQmtC+0L3QtdGGINC40LPRgNGLXCIsIHdpZHRoIC8gMiwgaGVpZ2h0IC8gMik7XHJcbn07XHJcblxyXG4vL9GA0LjRgdGD0LXQvCDQvtC60YDRg9C20L3QvtGB0YLRjCDQtNC70Y8gYXBwbGVcclxubGV0IGNpcmNsZSA9ICh4LHkscmFkaXVzLGZpbGxDaXJjbGUpPT57XHJcbiAgICBjdHguYmVnaW5QYXRoKCk7IC8v0YHQvtC30LTQsNC10YIg0L3QvtCy0YvQuSDQutC+0L3RgtGD0YBcclxuICAgIGN0eC5hcmMoeCx5LHJhZGl1cywwLE1hdGguUEkqMik7Ly/RgNC40YHQvtCy0LDQvdC40LUg0LTRg9CzXHJcbiAgICBpZiAoZmlsbENpcmNsZSl7XHJcbiAgICAgICAgY3R4LmZpbGwoKTsvL9C30LDQv9C+0LvQvdC10L3QtdC90L3QsNGPXHJcbiAgICB9ZWxzZXtcclxuICAgICAgICBjdHguc3Ryb2tlKCk7Ly/QutC+0L3RgtGD0YBcclxuICAgIH1cclxufTtcclxuXHJcbi8v0LfQsNC00LDQtdC8INGP0YfQtdC50LrRg1xyXG5jbGFzcyBCbG9ja3tcclxuICAgIGNvbnN0cnVjdG9yKGNvbCxyb3cpe1xyXG4gICAgICAgIHRoaXMuY29sID0gY29sO1xyXG4gICAgICAgIHRoaXMucm93ID0gcm93O1xyXG4gICAgfVxyXG4gICAgLy/RgNC40YHRg9C10Lwg0Y/Rh9C10LnQutC4XHJcbiAgICBkcmF3U3F1YXJlKGNvbG9yKXtcclxuICAgICAgICBsZXQgeCA9IHRoaXMuY29sICpibG9ja1NpemU7XHJcbiAgICAgICAgbGV0IHkgPSB0aGlzLnJvdyAqIGJsb2NrU2l6ZTtcclxuICAgICAgICBjdHguZmlsbFN0eWxlID0gY29sb3I7XHJcbiAgICAgICAgY3R4LmZpbGxSZWN0KHgseSxibG9ja1NpemUsYmxvY2tTaXplKTtcclxuICAgIH07XHJcbiAgICAvL9GA0LjRgdGD0LXQvCBhcHBsZVxyXG4gICAgZHJhd0NpcmNsZShjb2xvcil7XHJcbiAgICAgICAgbGV0IGNlbnRlclggPSB0aGlzLmNvbCpibG9ja1NpemUgKyBibG9ja1NpemUgLyAyO1xyXG4gICAgICAgIGxldCBjZW50ZXJZID0gdGhpcy5yb3cgKiBibG9ja1NpemUgKyBibG9ja1NpemUgLyAyO1xyXG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSBjb2xvcjtcclxuICAgICAgICBjaXJjbGUoY2VudGVyWCxjZW50ZXJZLGJsb2NrU2l6ZSAvIDIsIHRydWUpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvL9C/0YDQvtCy0LXRgNC60LAuINCd0LDRhdC+0LTQuNGC0YHRjyDQu9C4INGP0YfQtdC50LrQsCDQsiDRgtC+0Lkg0LbQtSDQv9C+0LfQuNGG0LjQuFxyXG4gICAgZXF1YWwob3RoZXJCbG9jayl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29sID09PSBvdGhlckJsb2NrLmNvbCAmJiB0aGlzLnJvdyA9PT0gb3RoZXJCbG9jay5yb3c7XHJcbiAgICB9O1xyXG59XHJcblxyXG4vL9C30LDQtNCw0LXQvCDQt9C80LXRjlxyXG5jbGFzcyBTbmFrZXtcclxuICAgIGNvbnN0cnVjdG9yKCl7XHJcbiAgICAgICAgdGhpcy5zZWdtZW50cyA9IFtcclxuICAgICAgICAgICAgbmV3IEJsb2NrKDMsMSksXHJcbiAgICAgICAgICAgIG5ldyBCbG9jaygyLDEpLFxyXG4gICAgICAgICAgICBuZXcgQmxvY2soMSwxKVxyXG4gICAgICAgIF07XHJcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBcInJpZ2h0XCI7Ly/RgtC10LrRg9GJ0LXQtSDQvdCw0L/RgNCw0LLQu9C10L3QuNC1XHJcbiAgICAgICAgdGhpcy5uZXh0RGlyZWN0aW9uID0gXCJyaWdodFwiOy8v0YHQu9C10LTRg9GO0YnQtdC1INC90LDQv9GA0LDQstC70LXQvdC40LVcclxuICAgIH1cclxuICAgIGRyYXcoKXtcclxuICAgICAgICAvLyBmb3IgKGxldCBzZWcgb2YgdGhpcy5zZWdtZW50cyl7XHJcbiAgICAgICAgLy8gICAgIHNlZy5kcmF3U3F1YXJlKFwiUmVkXCIpO1xyXG4gICAgICAgIC8vIH07IC8v0LLRgdC1INC+0LTQvdC40Lwg0YbQstC10YLQvtC8XHJcblxyXG5cclxuICAgICAgICB0aGlzLnNlZ21lbnRzWzBdLmRyYXdTcXVhcmUoXCJSZWRcIik7XHJcbiAgICAgICAgZm9yKGxldCBpID0gMTsgaSA8IHRoaXMuc2VnbWVudHMubGVuZ3RoOyBpKyspe1xyXG4gICAgICAgICAgICBpZiAoaSUyKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VnbWVudHNbaV0uZHJhd1NxdWFyZShcInllbGxvd1wiKTtcclxuICAgICAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWdtZW50c1tpXS5kcmF3U3F1YXJlKFwiYmx1ZVwiKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuICAgIC8v0L/QtdGA0LXQtNC40LbQtdC90LjQtSDQt9C80LXQuFxyXG4gICAgbW92ZSgpe1xyXG4gICAgICAgIGxldCBoZWFkID0gdGhpcy5zZWdtZW50c1swXTtcclxuICAgICAgICBsZXQgbmV3SGVhZDtcclxuXHJcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSB0aGlzLm5leHREaXJlY3Rpb247XHJcbiAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IFwicmlnaHRcIil7XHJcbiAgICAgICAgICAgIG5ld0hlYWQgPSBuZXcgQmxvY2soaGVhZC5jb2wrMSwgaGVhZC5yb3cpO1xyXG4gICAgICAgIH1lbHNlIGlmICh0aGlzLmRpcmVjdGlvbiA9PSBcImRvd25cIil7XHJcbiAgICAgICAgICAgIG5ld0hlYWQgPSBuZXcgQmxvY2soaGVhZC5jb2wsIGhlYWQucm93KzEpO1xyXG4gICAgICAgIH1lbHNlIGlmICh0aGlzLmRpcmVjdGlvbiA9PSBcImxlZnRcIil7XHJcbiAgICAgICAgICAgIG5ld0hlYWQgPSBuZXcgQmxvY2soaGVhZC5jb2wtMSwgaGVhZC5yb3cpO1xyXG4gICAgICAgIH1lbHNlIGlmICh0aGlzLmRpcmVjdGlvbiA9PSBcInVwXCIpe1xyXG4gICAgICAgICAgICBuZXdIZWFkID0gbmV3IEJsb2NrKGhlYWQuY29sLCBoZWFkLnJvdy0xKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAodGhpcy5jaGVja0NvbGxpc2lvbihuZXdIZWFkKSl7XHJcbiAgICAgICAgICAgIGNoZWNrQ29sbGlzaW9uSW5kaWNhdG9yID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLnNlZ21lbnRzLnVuc2hpZnQobmV3SGVhZCk7XHJcbiAgICAgICAgaWYgKG5ld0hlYWQuZXF1YWwoYXBwbGUucG9zaXRpb24pKXtcclxuICAgICAgICAgICAgc2NvcmUgKz0xO1xyXG4gICAgICAgICAgICBhcHBsZS5tb3ZlKCk7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIHRoaXMuc2VnbWVudHMucG9wKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIC8v0L/RgNC+0LLQtdGA0LrQsCDQvdCwINGB0YLQvtC70LrQvdC+0LLQtdC90LjQtSDRgSDRgdC+0LHQvtC5INC40LvQuCDRgdGC0LXQvdC+0LlcclxuICAgIGNoZWNrQ29sbGlzaW9uKGhlYWQpe1xyXG4gICAgICAgIGxldCBsZWZ0Q29sbGlzaW9uID0gKGhlYWQuY29sID09PSAwKTtcclxuICAgICAgICBsZXQgdG9wdENvbGxpc2lvbiA9IChoZWFkLnJvdyA9PT0gMCk7XHJcbiAgICAgICAgbGV0IHJpZ2h0dENvbGxpc2lvbiA9IChoZWFkLmNvbCA9PT0gd2lkdGhJbkJsb2NrcyAtIDEpOyBcclxuICAgICAgICBsZXQgYm90dG9tQ29sbGlzaW9uID0gKGhlYWQucm93ID09PSBoZWlnaHRJbkJsb2NrcyAtIDEpO1xyXG5cclxuICAgICAgICBsZXQgd2FsbENvbGxpc2lvbiA9IGxlZnRDb2xsaXNpb24gfHwgdG9wdENvbGxpc2lvbiB8fCByaWdodHRDb2xsaXNpb24gfHwgYm90dG9tQ29sbGlzaW9uO1xyXG5cclxuICAgICAgICBsZXQgc2VsZkNvbGxpc2lvbiA9IGZhbHNlO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBzZWcgb2YgdGhpcy5zZWdtZW50cyl7XHJcbiAgICAgICAgICAgIGlmIChoZWFkLmVxdWFsKHNlZykpe1xyXG4gICAgICAgICAgICAgICAgc2VsZkNvbGxpc2lvbiA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHdhbGxDb2xsaXNpb24gfHwgc2VsZkNvbGxpc2lvbjtcclxuICAgIH07XHJcbiAgICAvLyDQt9Cw0LTQsNC10Lwg0YHQu9C10LTRg9GO0YnQtdC1INC90LDQv9GA0LDQstC70LXQvdC40LUg0LfQvNC10LhcclxuICAgIHNldERpcmVjdGlvbihuZXdEaXJlY3Rpb24pe1xyXG4gICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PT0gXCJ1cFwiICYmIG5ld0RpcmVjdGlvbiA9PT0gXCJkb3duXCIpe1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfWVsc2UgaWYgKHRoaXMuZGlyZWN0aW9uID09PSBcInJpZ2h0XCIgJiYgbmV3RGlyZWN0aW9uID09PSBcImxlZnRcIil7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9ZWxzZSBpZiAodGhpcy5kaXJlY3Rpb24gPT09IFwiZG93blwiICYmIG5ld0RpcmVjdGlvbiA9PT0gXCJ1cFwiKXtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1lbHNlIGlmICh0aGlzLmRpcmVjdGlvbiA9PT0gXCJsZWZ0XCIgJiYgbmV3RGlyZWN0aW9uID09PSBcInJpZ2h0XCIpe1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5uZXh0RGlyZWN0aW9uID0gbmV3RGlyZWN0aW9uO1xyXG4gICAgfTtcclxufTtcclxuXHJcbmNsYXNzIEFwcGxlIHtcclxuICAgIGNvbnN0cnVjdG9yKCl7XHJcbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IG5ldyBCbG9jayh3aWR0aEluQmxvY2tzIC8gMixoZWlnaHRJbkJsb2NrcyAvIDIpO1xyXG4gICAgfTtcclxuXHJcbiAgICBkcmF3KCl7XHJcbiAgICAgICAgdGhpcy5wb3NpdGlvbi5kcmF3Q2lyY2xlKFwiTGltZUdyZWVuXCIpO1xyXG4gICAgfTtcclxuXHJcbiAgICBtb3ZlKCl7XHJcbiAgICAgICAgbGV0IHJhbmRvbUNvbCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICh3aWR0aEluQmxvY2tzIC0gMikgKyAxKTsvL9C/0L7Qs9GA0LDQvdC40YfQvdC+0LUg0LfQvdCw0YfQtdC90LjQtVxyXG4gICAgICAgIGxldCByYW5kb21Sb3cgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqIChoZWlnaHRJbkJsb2NrcyAtIDIpICsgMSk7Ly8g0L7RgiAxINC00L4gd2lkdGhJbkJsb2NrcyAtIDFcclxuICAgICAgICBsZXQgaSA9IDA7XHJcbiAgICAgICAgd2hpbGUoaSA8IHNuYWtlLnNlZ21lbnRzLmxlbmd0aCl7XHJcbiAgICAgICAgICAgIGlmIChzbmFrZS5zZWdtZW50c1tpXS5jb2wgPT09IHJhbmRvbUNvbCAmJiBzbmFrZS5zZWdtZW50c1tpXS5yb3cgPT09IHJhbmRvbVJvdyl7XHJcbiAgICAgICAgICAgICAgICByYW5kb21Db2wgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAod2lkdGhJbkJsb2NrcyAtIDIpICsgMSk7XHJcbiAgICAgICAgICAgICAgICByYW5kb21Sb3cgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqIChoZWlnaHRJbkJsb2NrcyAtIDIpICsgMSk7XHJcbiAgICAgICAgICAgICAgICBpID0gMDtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICBpICs9IDE7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLnBvc2l0aW9uID0gIG5ldyBCbG9jayAocmFuZG9tQ29sLHJhbmRvbVJvdyk7XHJcbiAgICB9O1xyXG59O1xyXG5cclxubGV0IHNuYWtlID0gbmV3IFNuYWtlKCk7XHJcbmxldCBhcHBsZSA9IG5ldyBBcHBsZSgpO1xyXG5cclxubGV0IGRpcmVjdGlvbiA9IHtcclxuICAgICAzNzogXCJsZWZ0XCIsXHJcbiAgICAgMzg6IFwidXBcIixcclxuICAgICAzOTogXCJyaWdodFwiLFxyXG4gICAgIDQwOiBcImRvd25cIlxyXG4gfVxyXG5cclxuICQoXCJib2R5XCIpLmtleWRvd24oZnVuY3Rpb24oZXZlbnQpe1xyXG4gICAgIGxldCBuZXdEaXJlY3Rpb24gPSBkaXJlY3Rpb25bZXZlbnQua2V5Q29kZV07XHJcblxyXG4gICAgIGlmIChuZXdEaXJlY3Rpb24gIT09IHVuZGVmaW5lZCl7XHJcbiAgICAgICAgIHNuYWtlLnNldERpcmVjdGlvbihuZXdEaXJlY3Rpb24pO1xyXG4gICAgIH1cclxufSk7XHJcblxyXG5cclxuLy8gbGV0IGludGVydmFsSWQgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpe1xyXG4vLyAgICAgY3R4LmNsZWFyUmVjdCgwLDAsd2lkdGgsaGVpZ2h0KTtcclxuLy8gICAgIGRyYXdTY29yZSgpO1xyXG4vLyAgICAgc25ha2UubW92ZSgpO1xyXG4vLyAgICAgc25ha2UuZHJhdygpO1xyXG4vLyAgICAgYXBwbGUuZHJhdygpO1xyXG4vLyAgICAgZHJhd0JvcmRlcigpO1xyXG4vLyB9LDEwMCk7XHJcblxyXG5cclxubGV0IGFuaW1hdGlvblRpbWUgPSAxMDA7XHJcbmxldCBsZXZlbE9mQ29tcGxleGl0eSA9IHNjb3JlICogMjtcclxuXHJcbmxldCB0aW1lb3V0SWQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uIGdhbWVMb29wKCl7IC8vINCk0YPQvdC60YbQuNGPINCx0YPQtNC10YIg0LbQuNGC0Ywg0LIg0L/QsNC80Y/RgtC4LCDQv9C+0LrQsCDQvdC1INGB0YDQsNCx0L7RgtCw0LsgKNC40LvQuCDQvdC1INCx0YvQuyDQvtGH0LjRidC10L0pINGC0LDQudC80LXRgFxyXG4gICAgY3R4LmNsZWFyUmVjdCgwLDAsd2lkdGgsaGVpZ2h0KTtcclxuICAgIGRyYXdTY29yZSgpO1xyXG4gICAgc25ha2UubW92ZSgpO1xyXG4gICAgc25ha2UuZHJhdygpO1xyXG4gICAgYXBwbGUuZHJhdygpO1xyXG4gICAgZHJhd0JvcmRlcigpO1xyXG4gICAgaWYgKGNoZWNrQ29sbGlzaW9uSW5kaWNhdG9yKXsgLy/Qv9GA0L7QstC10YDRj9C10Lwg0LTQu9GPINGC0L7Qs9C+LCDRh9GC0L7QsdGLINGA0LXQutGD0YDRgdC40Y8g0J3QlSDQstGL0LfRi9Cy0LDQu9Cw0YHRjCDQstC10YfQvdC+XHJcbiAgICAvL9C/0L7RgtC+0LzRgyDRh9GC0L4g0LHQtdC3INC90LXQtSDQv9C+0YHQu9C1INGB0YLQvtC70LrQvdC+0LLQtdC90LjRjyDQvNC+0LbQvdC+INC/0YDQvtC00L7Qu9C20LjRgtGMINC40LPRgNCw0YLRjCDRgiDQuiDRgNC10LrRg9GA0YHQuNGPINC90LUg0L7RgdGC0LDQvdCw0LLQu9C40LLQsNC10YLRgdGPXHJcbiAgICAgICAgc2V0VGltZW91dChnYW1lTG9vcCxhbmltYXRpb25UaW1lLWxldmVsT2ZDb21wbGV4aXR5KTtcclxuICAgIH1lbHNle1xyXG4gICAgICAgIGdhbWVPdmVyKCk7XHJcbiAgICB9XHJcbiAgICBcclxufSwxMDApOyJdfQ==

let canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d");const width=500,height=500;let score=0,checkCollisionIndicator=!0;canvas.width=width,canvas.height=height;const blockSize=10;let widthInBlocks=width/blockSize,heightInBlocks=height/blockSize,menu=()=>{ctx.clearRect(0,0,width,height),ctx.fillStyle="Black",ctx.fillRect(0,0,width,height),ctx.font="30px serif",ctx.fillStyle="White",ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillText("Start game",width/2,height/2),ctx.font="15px serif",ctx.fillText("press space",width/2,height/2+20)},drawBorder=()=>{ctx.fillStyle="Gray",ctx.fillRect(0,0,width,blockSize),ctx.fillRect(0,height-blockSize,width,blockSize),ctx.fillRect(0,0,blockSize,height),ctx.fillRect(width-blockSize,0,blockSize,height)},drawScore=()=>{ctx.font="20px Courier",ctx.fillStyle="Black",ctx.textAlign="left",ctx.textBaseline="top",ctx.fillText("Счет: "+score,blockSize,blockSize)},gameOver=()=>{clearTimeout(timeoutId),ctx.font="30px Courier",ctx.fillStyle="Black",ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillText("Конец игры",width/2,height/2)},circle=(t,e,i,o)=>{ctx.beginPath(),ctx.arc(t,e,i,0,2*Math.PI),o?ctx.fill():ctx.stroke()};class Block{constructor(t,e){this.col=t,this.row=e}drawSquare(t){let e=this.col*blockSize,i=this.row*blockSize;ctx.fillStyle=t,ctx.fillRect(e,i,blockSize,blockSize)}drawCircle(t){let e=this.col*blockSize+blockSize/2,i=this.row*blockSize+blockSize/2;ctx.fillStyle=t,circle(e,i,blockSize/2,!0)}equal(t){return this.col===t.col&&this.row===t.row}}class Snake{constructor(){this.segments=[new Block(3,1),new Block(2,1),new Block(1,1)],this.direction="right",this.nextDirection="right"}draw(){this.segments[0].drawSquare("Red");for(let t=1;t<this.segments.length;t++)t%2?this.segments[t].drawSquare("yellow"):this.segments[t].drawSquare("blue")}move(){let t,e=this.segments[0];this.direction=this.nextDirection,"right"==this.direction?t=new Block(e.col+1,e.row):"down"==this.direction?t=new Block(e.col,e.row+1):"left"==this.direction?t=new Block(e.col-1,e.row):"up"==this.direction&&(t=new Block(e.col,e.row-1)),this.checkCollision(t)?checkCollisionIndicator=!1:(this.segments.unshift(t),t.equal(apple.position)?(score+=1,apple.move()):this.segments.pop())}checkCollision(t){let e=0===t.col,i=0===t.row,o=t.col===widthInBlocks-1,l=t.row===heightInBlocks-1,c=e||i||o||l,n=!1;for(let e of this.segments)t.equal(e)&&(n=!0);return c||n}setDirection(t){"up"===this.direction&&"down"===t||"right"===this.direction&&"left"===t||"down"===this.direction&&"up"===t||"left"===this.direction&&"right"===t||(this.nextDirection=t)}}class Apple{constructor(){this.position=new Block(widthInBlocks/2,heightInBlocks/2)}draw(){this.position.drawCircle("LimeGreen")}move(){let t=Math.floor(Math.random()*(widthInBlocks-2)+1),e=Math.floor(Math.random()*(heightInBlocks-2)+1),i=0;for(;i<snake.segments.length;)snake.segments[i].col===t&&snake.segments[i].row===e?(t=Math.floor(Math.random()*(widthInBlocks-2)+1),e=Math.floor(Math.random()*(heightInBlocks-2)+1),i=0):i+=1;this.position=new Block(t,e)}}let snake=new Snake,apple=new Apple,direction={37:"left",38:"up",39:"right",40:"down"};$("body").keydown(function(t){let e=direction[t.keyCode];void 0!==e&&snake.setDirection(e),32===t.keyCode&&startDrawGame()});let animationTime=100,levelOfComplexity=2*score;function startDrawGame(){setTimeout(function t(){ctx.clearRect(0,0,width,height),drawScore(),snake.move(),snake.draw(),apple.draw(),drawBorder(),checkCollisionIndicator?setTimeout(t,animationTime-levelOfComplexity):gameOver()},100)}menu();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiY2FudmFzIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImN0eCIsImdldENvbnRleHQiLCJ3aWR0aCIsImhlaWdodCIsInNjb3JlIiwiY2hlY2tDb2xsaXNpb25JbmRpY2F0b3IiLCJibG9ja1NpemUiLCJ3aWR0aEluQmxvY2tzIiwiaGVpZ2h0SW5CbG9ja3MiLCJtZW51IiwiY2xlYXJSZWN0IiwiZmlsbFN0eWxlIiwiZmlsbFJlY3QiLCJmb250IiwidGV4dEFsaWduIiwidGV4dEJhc2VsaW5lIiwiZmlsbFRleHQiLCJkcmF3Qm9yZGVyIiwiZHJhd1Njb3JlIiwiZ2FtZU92ZXIiLCJjbGVhclRpbWVvdXQiLCJ0aW1lb3V0SWQiLCJjaXJjbGUiLCJ4IiwieSIsInJhZGl1cyIsImZpbGxDaXJjbGUiLCJiZWdpblBhdGgiLCJhcmMiLCJNYXRoIiwiUEkiLCJmaWxsIiwic3Ryb2tlIiwiQmxvY2siLCJbb2JqZWN0IE9iamVjdF0iLCJjb2wiLCJyb3ciLCJ0aGlzIiwiY29sb3IiLCJjZW50ZXJYIiwiY2VudGVyWSIsIm90aGVyQmxvY2siLCJTbmFrZSIsInNlZ21lbnRzIiwiZGlyZWN0aW9uIiwibmV4dERpcmVjdGlvbiIsImRyYXdTcXVhcmUiLCJpIiwibGVuZ3RoIiwibmV3SGVhZCIsImhlYWQiLCJjaGVja0NvbGxpc2lvbiIsInVuc2hpZnQiLCJlcXVhbCIsImFwcGxlIiwicG9zaXRpb24iLCJtb3ZlIiwicG9wIiwibGVmdENvbGxpc2lvbiIsInRvcHRDb2xsaXNpb24iLCJyaWdodHRDb2xsaXNpb24iLCJib3R0b21Db2xsaXNpb24iLCJ3YWxsQ29sbGlzaW9uIiwic2VsZkNvbGxpc2lvbiIsInNlZyIsIm5ld0RpcmVjdGlvbiIsIkFwcGxlIiwiZHJhd0NpcmNsZSIsInJhbmRvbUNvbCIsImZsb29yIiwicmFuZG9tIiwicmFuZG9tUm93Iiwic25ha2UiLCIzNyIsIjM4IiwiMzkiLCI0MCIsIiQiLCJrZXlkb3duIiwiZXZlbnQiLCJrZXlDb2RlIiwidW5kZWZpbmVkIiwic2V0RGlyZWN0aW9uIiwic3RhcnREcmF3R2FtZSIsImFuaW1hdGlvblRpbWUiLCJsZXZlbE9mQ29tcGxleGl0eSIsInNldFRpbWVvdXQiLCJnYW1lTG9vcCIsImRyYXciXSwibWFwcGluZ3MiOiJBQUNBLElBQUlBLE9BQVNDLFNBQVNDLGVBQWUsVUFDakNDLElBQU1ILE9BQU9JLFdBQVcsTUFFNUIsTUFBTUMsTUFBUSxJQUNSQyxPQUFRLElBQ2QsSUFBSUMsTUFBUSxFQUNSQyx5QkFBMEIsRUFJOUJSLE9BQU9LLE1BQVFBLE1BQ2ZMLE9BQU9NLE9BQVNBLE9BR2hCLE1BQU1HLFVBQVksR0FDbEIsSUFBSUMsY0FBZ0JMLE1BQVFJLFVBQ3hCRSxlQUFpQkwsT0FBU0csVUFHMUJHLEtBQU8sS0FDUFQsSUFBSVUsVUFBVSxFQUFFLEVBQUVSLE1BQU1DLFFBQ3hCSCxJQUFJVyxVQUFZLFFBQ2hCWCxJQUFJWSxTQUFTLEVBQUUsRUFBRVYsTUFBTUMsUUFFdkJILElBQUlhLEtBQU8sYUFDWGIsSUFBSVcsVUFBWSxRQUNoQlgsSUFBSWMsVUFBWSxTQUNoQmQsSUFBSWUsYUFBZSxTQUduQmYsSUFBSWdCLFNBQVMsYUFBY2QsTUFBUSxFQUFHQyxPQUFTLEdBQy9DSCxJQUFJYSxLQUFPLGFBQ1hiLElBQUlnQixTQUFTLGNBQWVkLE1BQVEsRUFBR0MsT0FBUyxFQUFJLEtBR3BEYyxXQUFhLEtBQ2JqQixJQUFJVyxVQUFZLE9BQ2hCWCxJQUFJWSxTQUFTLEVBQUUsRUFBRVYsTUFBTUksV0FDdkJOLElBQUlZLFNBQVMsRUFBRVQsT0FBU0csVUFBVUosTUFBTUksV0FDeENOLElBQUlZLFNBQVMsRUFBRSxFQUFFTixVQUFVSCxRQUMzQkgsSUFBSVksU0FBU1YsTUFBUUksVUFBVSxFQUFFQSxVQUFXSCxTQUc1Q2UsVUFBWSxLQUNabEIsSUFBSWEsS0FBTyxlQUNYYixJQUFJVyxVQUFZLFFBQ2hCWCxJQUFJYyxVQUFZLE9BQ2hCZCxJQUFJZSxhQUFlLE1BQ25CZixJQUFJZ0IsU0FBUyxTQUFVWixNQUFNRSxVQUFVQSxZQUd2Q2EsU0FBVyxLQUdYQyxhQUFhQyxXQUNickIsSUFBSWEsS0FBTyxlQUNYYixJQUFJVyxVQUFZLFFBQ2hCWCxJQUFJYyxVQUFZLFNBQ2hCZCxJQUFJZSxhQUFlLFNBQ25CZixJQUFJZ0IsU0FBUyxhQUFjZCxNQUFRLEVBQUdDLE9BQVMsSUFJL0NtQixPQUFTLENBQUNDLEVBQUVDLEVBQUVDLEVBQU9DLEtBQ3JCMUIsSUFBSTJCLFlBQ0ozQixJQUFJNEIsSUFBSUwsRUFBRUMsRUFBRUMsRUFBTyxFQUFVLEVBQVJJLEtBQUtDLElBQ3RCSixFQUNBMUIsSUFBSStCLE9BRUovQixJQUFJZ0MsVUFLWixNQUFNQyxNQUNGQyxZQUFZQyxFQUFJQyxHQUNaQyxLQUFLRixJQUFNQSxFQUNYRSxLQUFLRCxJQUFNQSxFQUdmRixXQUFXSSxHQUNQLElBQUlmLEVBQUljLEtBQUtGLElBQUs3QixVQUNka0IsRUFBSWEsS0FBS0QsSUFBTTlCLFVBQ25CTixJQUFJVyxVQUFZMkIsRUFDaEJ0QyxJQUFJWSxTQUFTVyxFQUFFQyxFQUFFbEIsVUFBVUEsV0FHL0I0QixXQUFXSSxHQUNQLElBQUlDLEVBQVVGLEtBQUtGLElBQUk3QixVQUFZQSxVQUFZLEVBQzNDa0MsRUFBVUgsS0FBS0QsSUFBTTlCLFVBQVlBLFVBQVksRUFDakROLElBQUlXLFVBQVkyQixFQUNoQmhCLE9BQU9pQixFQUFRQyxFQUFRbEMsVUFBWSxHQUFHLEdBSTFDNEIsTUFBTU8sR0FDRixPQUFPSixLQUFLRixNQUFRTSxFQUFXTixLQUFPRSxLQUFLRCxNQUFRSyxFQUFXTCxLQUt0RSxNQUFNTSxNQUNGUixjQUNJRyxLQUFLTSxTQUFXLENBQ1osSUFBSVYsTUFBTSxFQUFFLEdBQ1osSUFBSUEsTUFBTSxFQUFFLEdBQ1osSUFBSUEsTUFBTSxFQUFFLElBRWhCSSxLQUFLTyxVQUFZLFFBQ2pCUCxLQUFLUSxjQUFnQixRQUV6QlgsT0FNSUcsS0FBS00sU0FBUyxHQUFHRyxXQUFXLE9BQzVCLElBQUksSUFBSUMsRUFBSSxFQUFHQSxFQUFJVixLQUFLTSxTQUFTSyxPQUFRRCxJQUNqQ0EsRUFBRSxFQUNGVixLQUFLTSxTQUFTSSxHQUFHRCxXQUFXLFVBRTVCVCxLQUFLTSxTQUFTSSxHQUFHRCxXQUFXLFFBTXhDWixPQUNJLElBQ0llLEVBREFDLEVBQU9iLEtBQUtNLFNBQVMsR0FHekJOLEtBQUtPLFVBQVlQLEtBQUtRLGNBQ0EsU0FBbEJSLEtBQUtPLFVBQ0xLLEVBQVUsSUFBSWhCLE1BQU1pQixFQUFLZixJQUFJLEVBQUdlLEVBQUtkLEtBQ2IsUUFBbEJDLEtBQUtPLFVBQ1hLLEVBQVUsSUFBSWhCLE1BQU1pQixFQUFLZixJQUFLZSxFQUFLZCxJQUFJLEdBQ2YsUUFBbEJDLEtBQUtPLFVBQ1hLLEVBQVUsSUFBSWhCLE1BQU1pQixFQUFLZixJQUFJLEVBQUdlLEVBQUtkLEtBQ2IsTUFBbEJDLEtBQUtPLFlBQ1hLLEVBQVUsSUFBSWhCLE1BQU1pQixFQUFLZixJQUFLZSxFQUFLZCxJQUFJLElBR3ZDQyxLQUFLYyxlQUFlRixHQUNwQjVDLHlCQUEwQixHQUk5QmdDLEtBQUtNLFNBQVNTLFFBQVFILEdBQ2xCQSxFQUFRSSxNQUFNQyxNQUFNQyxXQUNwQm5ELE9BQVEsRUFDUmtELE1BQU1FLFFBRU5uQixLQUFLTSxTQUFTYyxPQUl0QnZCLGVBQWVnQixHQUNYLElBQUlRLEVBQThCLElBQWJSLEVBQUtmLElBQ3RCd0IsRUFBOEIsSUFBYlQsRUFBS2QsSUFDdEJ3QixFQUFtQlYsRUFBS2YsTUFBUTVCLGNBQWdCLEVBQ2hEc0QsRUFBbUJYLEVBQUtkLE1BQVE1QixlQUFpQixFQUVqRHNELEVBQWdCSixHQUFpQkMsR0FBaUJDLEdBQW1CQyxFQUVyRUUsR0FBZ0IsRUFFcEIsSUFBSyxJQUFJQyxLQUFPM0IsS0FBS00sU0FDYk8sRUFBS0csTUFBTVcsS0FDWEQsR0FBZ0IsR0FHeEIsT0FBT0QsR0FBaUJDLEVBRzVCN0IsYUFBYStCLEdBQ2MsT0FBbkI1QixLQUFLTyxXQUF1QyxTQUFqQnFCLEdBRUYsVUFBbkI1QixLQUFLTyxXQUEwQyxTQUFqQnFCLEdBRVgsU0FBbkI1QixLQUFLTyxXQUF5QyxPQUFqQnFCLEdBRVYsU0FBbkI1QixLQUFLTyxXQUF5QyxVQUFqQnFCLElBSXZDNUIsS0FBS1EsY0FBZ0JvQixJQUk3QixNQUFNQyxNQUNGaEMsY0FDSUcsS0FBS2tCLFNBQVcsSUFBSXRCLE1BQU0xQixjQUFnQixFQUFFQyxlQUFpQixHQUdqRTBCLE9BQ0lHLEtBQUtrQixTQUFTWSxXQUFXLGFBRzdCakMsT0FDSSxJQUFJa0MsRUFBWXZDLEtBQUt3QyxNQUFNeEMsS0FBS3lDLFVBQVkvRCxjQUFnQixHQUFLLEdBQzdEZ0UsRUFBWTFDLEtBQUt3QyxNQUFNeEMsS0FBS3lDLFVBQVc5RCxlQUFpQixHQUFLLEdBQzdEdUMsRUFBSSxFQUNSLEtBQU1BLEVBQUl5QixNQUFNN0IsU0FBU0ssUUFDakJ3QixNQUFNN0IsU0FBU0ksR0FBR1osTUFBUWlDLEdBQWFJLE1BQU03QixTQUFTSSxHQUFHWCxNQUFRbUMsR0FDakVILEVBQVl2QyxLQUFLd0MsTUFBTXhDLEtBQUt5QyxVQUFZL0QsY0FBZ0IsR0FBSyxHQUM3RGdFLEVBQVkxQyxLQUFLd0MsTUFBTXhDLEtBQUt5QyxVQUFXOUQsZUFBaUIsR0FBSyxHQUM3RHVDLEVBQUksR0FFSkEsR0FBSyxFQUdiVixLQUFLa0IsU0FBWSxJQUFJdEIsTUFBT21DLEVBQVVHLElBTTlDLElBQUlDLE1BQVEsSUFBSTlCLE1BQ1pZLE1BQVEsSUFBSVksTUFFWnRCLFVBQVksQ0FDWDZCLEdBQUksT0FDSkMsR0FBSSxLQUNKQyxHQUFJLFFBQ0pDLEdBQUksUUFHUkMsRUFBRSxRQUFRQyxRQUFRLFNBQVNDLEdBQ3ZCLElBQUlkLEVBQWVyQixVQUFVbUMsRUFBTUMsY0FFZEMsSUFBakJoQixHQUNBTyxNQUFNVSxhQUFhakIsR0FFRixLQUFsQmMsRUFBTUMsU0FDTkcsa0JBZVIsSUFBSUMsY0FBZ0IsSUFDaEJDLGtCQUE0QixFQUFSakYsTUFFeEIsU0FBUytFLGdCQUtXRyxXQUFXLFNBQVNDLElBQ2hDdkYsSUFBSVUsVUFBVSxFQUFFLEVBQUVSLE1BQU1DLFFBQ3hCZSxZQUNBc0QsTUFBTWhCLE9BQ05nQixNQUFNZ0IsT0FDTmxDLE1BQU1rQyxPQUNOdkUsYUFDSVosd0JBRUFpRixXQUFXQyxFQUFTSCxjQUFjQyxtQkFFbENsRSxZQUdOLEtBR05WIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvL9C90LDRgdGC0YDQvtC50LrQsCDRhdC+0LvRgdGC0LBcclxubGV0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY2FudmFzXCIpO1xyXG5sZXQgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcclxuXHJcbmNvbnN0IHdpZHRoID0gNTAwOy8vY2FudmFzLndpZHRoO1xyXG5jb25zdCBoZWlnaHQgPTUwMDsvL2NhbnZhcy5oZWlnaHQ7XHJcbmxldCBzY29yZSA9IDA7XHJcbmxldCBjaGVja0NvbGxpc2lvbkluZGljYXRvciA9IHRydWU7IC8vINC00LvRjyDRgtC+0LPQviwg0YfRgtC+0LHRiyDQv9GA0Lgg0YDQtdC60YPRgNGB0LjQstC90L7QvCDQstGL0LfQvtCy0LVcclxuLy9zZXRUaW1lb3V0INCy0YvQudGC0LguXHJcblxyXG5cclxuY2FudmFzLndpZHRoID0gd2lkdGg7XHJcbmNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7XHJcblxyXG4vL9Cy0YvRh9C40YHQu9GP0LXQvCDRiNC40YDQuNC90YMg0Lgg0LLRi9GB0L7RgtGDINGP0YfQtdC50LrQuFxyXG5jb25zdCBibG9ja1NpemUgPSAxMDtcclxubGV0IHdpZHRoSW5CbG9ja3MgPSB3aWR0aCAvIGJsb2NrU2l6ZTtcclxubGV0IGhlaWdodEluQmxvY2tzID0gaGVpZ2h0IC8gYmxvY2tTaXplO1xyXG5cclxuLy/RgNC40YHRg9C10LwgTUVOVVxyXG5sZXQgbWVudSA9ICgpID0+e1xyXG4gICAgY3R4LmNsZWFyUmVjdCgwLDAsd2lkdGgsaGVpZ2h0KTtcclxuICAgIGN0eC5maWxsU3R5bGUgPSBcIkJsYWNrXCI7XHJcbiAgICBjdHguZmlsbFJlY3QoMCwwLHdpZHRoLGhlaWdodCk7XHJcblxyXG4gICAgY3R4LmZvbnQgPSBcIjMwcHggc2VyaWZcIjtcclxuICAgIGN0eC5maWxsU3R5bGUgPSBcIldoaXRlXCI7XHJcbiAgICBjdHgudGV4dEFsaWduID0gXCJjZW50ZXJcIjtcclxuICAgIGN0eC50ZXh0QmFzZWxpbmUgPSBcIm1pZGRsZVwiO1xyXG5cclxuXHJcbiAgICBjdHguZmlsbFRleHQoXCJTdGFydCBnYW1lXCIsIHdpZHRoIC8gMiwgaGVpZ2h0IC8gMik7XHJcbiAgICBjdHguZm9udCA9IFwiMTVweCBzZXJpZlwiO1xyXG4gICAgY3R4LmZpbGxUZXh0KFwicHJlc3Mgc3BhY2VcIiwgd2lkdGggLyAyLCBoZWlnaHQgLyAyICsgMjApO1xyXG59XHJcbi8v0YDQuNGB0YPQtdC8INGA0LDQvNC60YNcclxubGV0IGRyYXdCb3JkZXIgPSAoKSA9PntcclxuICAgIGN0eC5maWxsU3R5bGUgPSBcIkdyYXlcIjtcclxuICAgIGN0eC5maWxsUmVjdCgwLDAsd2lkdGgsYmxvY2tTaXplKTsvL9Cy0LXRgNGFXHJcbiAgICBjdHguZmlsbFJlY3QoMCxoZWlnaHQgLSBibG9ja1NpemUsd2lkdGgsYmxvY2tTaXplKTsvL9C90LjQt1xyXG4gICAgY3R4LmZpbGxSZWN0KDAsMCxibG9ja1NpemUsaGVpZ2h0KTsvL9C70LXQstC+XHJcbiAgICBjdHguZmlsbFJlY3Qod2lkdGggLSBibG9ja1NpemUsMCxibG9ja1NpemUsIGhlaWdodCk7Ly/Qv9GA0LDQstC+XHJcbn07XHJcbi8v0JLRi9Cy0L7QtNC40Lwg0YHRh9C10YJcclxubGV0IGRyYXdTY29yZSA9ICgpID0+IHtcclxuICAgIGN0eC5mb250ID0gXCIyMHB4IENvdXJpZXJcIjtcclxuICAgIGN0eC5maWxsU3R5bGUgPSBcIkJsYWNrXCI7XHJcbiAgICBjdHgudGV4dEFsaWduID0gXCJsZWZ0XCI7XHJcbiAgICBjdHgudGV4dEJhc2VsaW5lID0gXCJ0b3BcIjtcclxuICAgIGN0eC5maWxsVGV4dChcItCh0YfQtdGCOiBcIisgc2NvcmUsYmxvY2tTaXplLGJsb2NrU2l6ZSk7XHJcbn07XHJcbi8vINCa0L7QvdC10YYg0LjQs9GA0YtcclxubGV0IGdhbWVPdmVyID0gKCkgPT4ge1xyXG4gICAgLy9jbGVhckludGVydmFsKGludGVydmFsSWQpOy8v0L7RgdGC0LDQvdC+0LLQutCwINGB0YfQtdGC0YfQuNC60LAg0LTQu9GPIHNldEludGVydmFsXHJcblxyXG4gICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7XHJcbiAgICBjdHguZm9udCA9IFwiMzBweCBDb3VyaWVyXCI7XHJcbiAgICBjdHguZmlsbFN0eWxlID0gXCJCbGFja1wiO1xyXG4gICAgY3R4LnRleHRBbGlnbiA9IFwiY2VudGVyXCI7XHJcbiAgICBjdHgudGV4dEJhc2VsaW5lID0gXCJtaWRkbGVcIjtcclxuICAgIGN0eC5maWxsVGV4dChcItCa0L7QvdC10YYg0LjQs9GA0YtcIiwgd2lkdGggLyAyLCBoZWlnaHQgLyAyKTtcclxufTtcclxuXHJcbi8v0YDQuNGB0YPQtdC8INC+0LrRgNGD0LbQvdC+0YHRgtGMINC00LvRjyBhcHBsZVxyXG5sZXQgY2lyY2xlID0gKHgseSxyYWRpdXMsZmlsbENpcmNsZSk9PntcclxuICAgIGN0eC5iZWdpblBhdGgoKTsgLy/RgdC+0LfQtNCw0LXRgiDQvdC+0LLRi9C5INC60L7QvdGC0YPRgFxyXG4gICAgY3R4LmFyYyh4LHkscmFkaXVzLDAsTWF0aC5QSSoyKTsvL9GA0LjRgdC+0LLQsNC90LjQtSDQtNGD0LNcclxuICAgIGlmIChmaWxsQ2lyY2xlKXtcclxuICAgICAgICBjdHguZmlsbCgpOy8v0LfQsNC/0L7Qu9C90LXQvdC10L3QvdCw0Y9cclxuICAgIH1lbHNle1xyXG4gICAgICAgIGN0eC5zdHJva2UoKTsvL9C60L7QvdGC0YPRgFxyXG4gICAgfVxyXG59O1xyXG5cclxuLy/Qt9Cw0LTQsNC10Lwg0Y/Rh9C10LnQutGDXHJcbmNsYXNzIEJsb2Nre1xyXG4gICAgY29uc3RydWN0b3IoY29sLHJvdyl7XHJcbiAgICAgICAgdGhpcy5jb2wgPSBjb2w7XHJcbiAgICAgICAgdGhpcy5yb3cgPSByb3c7XHJcbiAgICB9XHJcbiAgICAvL9GA0LjRgdGD0LXQvCDRj9GH0LXQudC60LhcclxuICAgIGRyYXdTcXVhcmUoY29sb3Ipe1xyXG4gICAgICAgIGxldCB4ID0gdGhpcy5jb2wgKmJsb2NrU2l6ZTtcclxuICAgICAgICBsZXQgeSA9IHRoaXMucm93ICogYmxvY2tTaXplO1xyXG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSBjb2xvcjtcclxuICAgICAgICBjdHguZmlsbFJlY3QoeCx5LGJsb2NrU2l6ZSxibG9ja1NpemUpO1xyXG4gICAgfTtcclxuICAgIC8v0YDQuNGB0YPQtdC8IGFwcGxlXHJcbiAgICBkcmF3Q2lyY2xlKGNvbG9yKXtcclxuICAgICAgICBsZXQgY2VudGVyWCA9IHRoaXMuY29sKmJsb2NrU2l6ZSArIGJsb2NrU2l6ZSAvIDI7XHJcbiAgICAgICAgbGV0IGNlbnRlclkgPSB0aGlzLnJvdyAqIGJsb2NrU2l6ZSArIGJsb2NrU2l6ZSAvIDI7XHJcbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGNvbG9yO1xyXG4gICAgICAgIGNpcmNsZShjZW50ZXJYLGNlbnRlclksYmxvY2tTaXplIC8gMiwgdHJ1ZSk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8v0L/RgNC+0LLQtdGA0LrQsC4g0J3QsNGF0L7QtNC40YLRgdGPINC70Lgg0Y/Rh9C10LnQutCwINCyINGC0L7QuSDQttC1INC/0L7Qt9C40YbQuNC4XHJcbiAgICBlcXVhbChvdGhlckJsb2NrKXtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb2wgPT09IG90aGVyQmxvY2suY29sICYmIHRoaXMucm93ID09PSBvdGhlckJsb2NrLnJvdztcclxuICAgIH07XHJcbn1cclxuXHJcbi8v0LfQsNC00LDQtdC8INC30LzQtdGOXHJcbmNsYXNzIFNuYWtle1xyXG4gICAgY29uc3RydWN0b3IoKXtcclxuICAgICAgICB0aGlzLnNlZ21lbnRzID0gW1xyXG4gICAgICAgICAgICBuZXcgQmxvY2soMywxKSxcclxuICAgICAgICAgICAgbmV3IEJsb2NrKDIsMSksXHJcbiAgICAgICAgICAgIG5ldyBCbG9jaygxLDEpXHJcbiAgICAgICAgXTtcclxuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IFwicmlnaHRcIjsvL9GC0LXQutGD0YnQtdC1INC90LDQv9GA0LDQstC70LXQvdC40LVcclxuICAgICAgICB0aGlzLm5leHREaXJlY3Rpb24gPSBcInJpZ2h0XCI7Ly/RgdC70LXQtNGD0Y7RidC10LUg0L3QsNC/0YDQsNCy0LvQtdC90LjQtVxyXG4gICAgfVxyXG4gICAgZHJhdygpe1xyXG4gICAgICAgIC8vIGZvciAobGV0IHNlZyBvZiB0aGlzLnNlZ21lbnRzKXtcclxuICAgICAgICAvLyAgICAgc2VnLmRyYXdTcXVhcmUoXCJSZWRcIik7XHJcbiAgICAgICAgLy8gfTsgLy/QstGB0LUg0L7QtNC90LjQvCDRhtCy0LXRgtC+0LxcclxuXHJcblxyXG4gICAgICAgIHRoaXMuc2VnbWVudHNbMF0uZHJhd1NxdWFyZShcIlJlZFwiKTtcclxuICAgICAgICBmb3IobGV0IGkgPSAxOyBpIDwgdGhpcy5zZWdtZW50cy5sZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgIGlmIChpJTIpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWdtZW50c1tpXS5kcmF3U3F1YXJlKFwieWVsbG93XCIpO1xyXG4gICAgICAgICAgICB9ZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlZ21lbnRzW2ldLmRyYXdTcXVhcmUoXCJibHVlXCIpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG4gICAgLy/Qv9C10YDQtdC00LjQttC10L3QuNC1INC30LzQtdC4XHJcbiAgICBtb3ZlKCl7XHJcbiAgICAgICAgbGV0IGhlYWQgPSB0aGlzLnNlZ21lbnRzWzBdO1xyXG4gICAgICAgIGxldCBuZXdIZWFkO1xyXG5cclxuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IHRoaXMubmV4dERpcmVjdGlvbjtcclxuICAgICAgICBpZiAodGhpcy5kaXJlY3Rpb24gPT0gXCJyaWdodFwiKXtcclxuICAgICAgICAgICAgbmV3SGVhZCA9IG5ldyBCbG9jayhoZWFkLmNvbCsxLCBoZWFkLnJvdyk7XHJcbiAgICAgICAgfWVsc2UgaWYgKHRoaXMuZGlyZWN0aW9uID09IFwiZG93blwiKXtcclxuICAgICAgICAgICAgbmV3SGVhZCA9IG5ldyBCbG9jayhoZWFkLmNvbCwgaGVhZC5yb3crMSk7XHJcbiAgICAgICAgfWVsc2UgaWYgKHRoaXMuZGlyZWN0aW9uID09IFwibGVmdFwiKXtcclxuICAgICAgICAgICAgbmV3SGVhZCA9IG5ldyBCbG9jayhoZWFkLmNvbC0xLCBoZWFkLnJvdyk7XHJcbiAgICAgICAgfWVsc2UgaWYgKHRoaXMuZGlyZWN0aW9uID09IFwidXBcIil7XHJcbiAgICAgICAgICAgIG5ld0hlYWQgPSBuZXcgQmxvY2soaGVhZC5jb2wsIGhlYWQucm93LTEpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmNoZWNrQ29sbGlzaW9uKG5ld0hlYWQpKXtcclxuICAgICAgICAgICAgY2hlY2tDb2xsaXNpb25JbmRpY2F0b3IgPSBmYWxzZTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuc2VnbWVudHMudW5zaGlmdChuZXdIZWFkKTtcclxuICAgICAgICBpZiAobmV3SGVhZC5lcXVhbChhcHBsZS5wb3NpdGlvbikpe1xyXG4gICAgICAgICAgICBzY29yZSArPTE7XHJcbiAgICAgICAgICAgIGFwcGxlLm1vdmUoKTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgdGhpcy5zZWdtZW50cy5wb3AoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgLy/Qv9GA0L7QstC10YDQutCwINC90LAg0YHRgtC+0LvQutC90L7QstC10L3QuNC1INGBINGB0L7QsdC+0Lkg0LjQu9C4INGB0YLQtdC90L7QuVxyXG4gICAgY2hlY2tDb2xsaXNpb24oaGVhZCl7XHJcbiAgICAgICAgbGV0IGxlZnRDb2xsaXNpb24gPSAoaGVhZC5jb2wgPT09IDApO1xyXG4gICAgICAgIGxldCB0b3B0Q29sbGlzaW9uID0gKGhlYWQucm93ID09PSAwKTtcclxuICAgICAgICBsZXQgcmlnaHR0Q29sbGlzaW9uID0gKGhlYWQuY29sID09PSB3aWR0aEluQmxvY2tzIC0gMSk7IFxyXG4gICAgICAgIGxldCBib3R0b21Db2xsaXNpb24gPSAoaGVhZC5yb3cgPT09IGhlaWdodEluQmxvY2tzIC0gMSk7XHJcblxyXG4gICAgICAgIGxldCB3YWxsQ29sbGlzaW9uID0gbGVmdENvbGxpc2lvbiB8fCB0b3B0Q29sbGlzaW9uIHx8IHJpZ2h0dENvbGxpc2lvbiB8fCBib3R0b21Db2xsaXNpb247XHJcblxyXG4gICAgICAgIGxldCBzZWxmQ29sbGlzaW9uID0gZmFsc2U7XHJcblxyXG4gICAgICAgIGZvciAobGV0IHNlZyBvZiB0aGlzLnNlZ21lbnRzKXtcclxuICAgICAgICAgICAgaWYgKGhlYWQuZXF1YWwoc2VnKSl7XHJcbiAgICAgICAgICAgICAgICBzZWxmQ29sbGlzaW9uID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gd2FsbENvbGxpc2lvbiB8fCBzZWxmQ29sbGlzaW9uO1xyXG4gICAgfTtcclxuICAgIC8vINC30LDQtNCw0LXQvCDRgdC70LXQtNGD0Y7RidC10LUg0L3QsNC/0YDQsNCy0LvQtdC90LjQtSDQt9C80LXQuFxyXG4gICAgc2V0RGlyZWN0aW9uKG5ld0RpcmVjdGlvbil7XHJcbiAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09PSBcInVwXCIgJiYgbmV3RGlyZWN0aW9uID09PSBcImRvd25cIil7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9ZWxzZSBpZiAodGhpcy5kaXJlY3Rpb24gPT09IFwicmlnaHRcIiAmJiBuZXdEaXJlY3Rpb24gPT09IFwibGVmdFwiKXtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1lbHNlIGlmICh0aGlzLmRpcmVjdGlvbiA9PT0gXCJkb3duXCIgJiYgbmV3RGlyZWN0aW9uID09PSBcInVwXCIpe1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfWVsc2UgaWYgKHRoaXMuZGlyZWN0aW9uID09PSBcImxlZnRcIiAmJiBuZXdEaXJlY3Rpb24gPT09IFwicmlnaHRcIil7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLm5leHREaXJlY3Rpb24gPSBuZXdEaXJlY3Rpb247XHJcbiAgICB9O1xyXG59O1xyXG5cclxuY2xhc3MgQXBwbGUge1xyXG4gICAgY29uc3RydWN0b3IoKXtcclxuICAgICAgICB0aGlzLnBvc2l0aW9uID0gbmV3IEJsb2NrKHdpZHRoSW5CbG9ja3MgLyAyLGhlaWdodEluQmxvY2tzIC8gMik7XHJcbiAgICB9O1xyXG5cclxuICAgIGRyYXcoKXtcclxuICAgICAgICB0aGlzLnBvc2l0aW9uLmRyYXdDaXJjbGUoXCJMaW1lR3JlZW5cIik7XHJcbiAgICB9O1xyXG5cclxuICAgIG1vdmUoKXtcclxuICAgICAgICBsZXQgcmFuZG9tQ29sID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKHdpZHRoSW5CbG9ja3MgLSAyKSArIDEpOy8v0L/QvtCz0YDQsNC90LjRh9C90L7QtSDQt9C90LDRh9C10L3QuNC1XHJcbiAgICAgICAgbGV0IHJhbmRvbVJvdyA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSogKGhlaWdodEluQmxvY2tzIC0gMikgKyAxKTsvLyDQvtGCIDEg0LTQviB3aWR0aEluQmxvY2tzIC0gMVxyXG4gICAgICAgIGxldCBpID0gMDtcclxuICAgICAgICB3aGlsZShpIDwgc25ha2Uuc2VnbWVudHMubGVuZ3RoKXtcclxuICAgICAgICAgICAgaWYgKHNuYWtlLnNlZ21lbnRzW2ldLmNvbCA9PT0gcmFuZG9tQ29sICYmIHNuYWtlLnNlZ21lbnRzW2ldLnJvdyA9PT0gcmFuZG9tUm93KXtcclxuICAgICAgICAgICAgICAgIHJhbmRvbUNvbCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICh3aWR0aEluQmxvY2tzIC0gMikgKyAxKTtcclxuICAgICAgICAgICAgICAgIHJhbmRvbVJvdyA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSogKGhlaWdodEluQmxvY2tzIC0gMikgKyAxKTtcclxuICAgICAgICAgICAgICAgIGkgPSAwO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgIGkgKz0gMTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMucG9zaXRpb24gPSAgbmV3IEJsb2NrIChyYW5kb21Db2wscmFuZG9tUm93KTtcclxuICAgIH07XHJcbn07XHJcblxyXG5cclxuLy/RgdC+0LfQtNCw0L3QuNC1INC+0LHRitC10LrRgtC+0LJcclxubGV0IHNuYWtlID0gbmV3IFNuYWtlKCk7XHJcbmxldCBhcHBsZSA9IG5ldyBBcHBsZSgpO1xyXG5cclxubGV0IGRpcmVjdGlvbiA9IHtcclxuICAgICAzNzogXCJsZWZ0XCIsXHJcbiAgICAgMzg6IFwidXBcIixcclxuICAgICAzOTogXCJyaWdodFwiLFxyXG4gICAgIDQwOiBcImRvd25cIlxyXG4gfVxyXG5cclxuICQoXCJib2R5XCIpLmtleWRvd24oZnVuY3Rpb24oZXZlbnQpe1xyXG4gICAgIGxldCBuZXdEaXJlY3Rpb24gPSBkaXJlY3Rpb25bZXZlbnQua2V5Q29kZV07XHJcblxyXG4gICAgIGlmIChuZXdEaXJlY3Rpb24gIT09IHVuZGVmaW5lZCl7XHJcbiAgICAgICAgIHNuYWtlLnNldERpcmVjdGlvbihuZXdEaXJlY3Rpb24pO1xyXG4gICAgIH07XHJcbiAgICAgaWYoZXZlbnQua2V5Q29kZSA9PT0gMzIpe1xyXG4gICAgICAgIHN0YXJ0RHJhd0dhbWUoKTtcclxuICAgIH1cclxufSk7XHJcblxyXG5cclxuLy8gbGV0IGludGVydmFsSWQgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpe1xyXG4vLyAgICAgY3R4LmNsZWFyUmVjdCgwLDAsd2lkdGgsaGVpZ2h0KTtcclxuLy8gICAgIGRyYXdTY29yZSgpO1xyXG4vLyAgICAgc25ha2UubW92ZSgpO1xyXG4vLyAgICAgc25ha2UuZHJhdygpO1xyXG4vLyAgICAgYXBwbGUuZHJhdygpO1xyXG4vLyAgICAgZHJhd0JvcmRlcigpO1xyXG4vLyB9LDEwMCk7XHJcblxyXG5cclxubGV0IGFuaW1hdGlvblRpbWUgPSAxMDA7XHJcbmxldCBsZXZlbE9mQ29tcGxleGl0eSA9IHNjb3JlICogMjtcclxuXHJcbmZ1bmN0aW9uIHN0YXJ0RHJhd0dhbWUgKCl7XHJcblxyXG4gICAgLy8gdGltZW91dElkINC70L7QutCw0LvRjNC90LDRjyDQv9C10YDQtdC80LXQvdC90LDRj1xyXG5cclxuXHJcbiAgICBsZXQgdGltZW91dElkID0gc2V0VGltZW91dChmdW5jdGlvbiBnYW1lTG9vcCgpeyAvLyDQpNGD0L3QutGG0LjRjyDQsdGD0LTQtdGCINC20LjRgtGMINCyINC/0LDQvNGP0YLQuCwg0L/QvtC60LAg0L3QtSDRgdGA0LDQsdC+0YLQsNC7ICjQuNC70Lgg0L3QtSDQsdGL0Lsg0L7Rh9C40YnQtdC9KSDRgtCw0LnQvNC10YBcclxuICAgICAgICBjdHguY2xlYXJSZWN0KDAsMCx3aWR0aCxoZWlnaHQpO1xyXG4gICAgICAgIGRyYXdTY29yZSgpO1xyXG4gICAgICAgIHNuYWtlLm1vdmUoKTtcclxuICAgICAgICBzbmFrZS5kcmF3KCk7XHJcbiAgICAgICAgYXBwbGUuZHJhdygpO1xyXG4gICAgICAgIGRyYXdCb3JkZXIoKTtcclxuICAgICAgICBpZiAoY2hlY2tDb2xsaXNpb25JbmRpY2F0b3IpeyAvL9C/0YDQvtCy0LXRgNGP0LXQvCDQtNC70Y8g0YLQvtCz0L4sINGH0YLQvtCx0Ysg0YDQtdC60YPRgNGB0LjRjyDQndCVINCy0YvQt9GL0LLQsNC70LDRgdGMINCy0LXRh9C90L5cclxuICAgICAgICAvL9C/0L7RgtC+0LzRgyDRh9GC0L4g0LHQtdC3INC90LXQtSDQv9C+0YHQu9C1INGB0YLQvtC70LrQvdC+0LLQtdC90LjRjyDQvNC+0LbQvdC+INC/0YDQvtC00L7Qu9C20LjRgtGMINC40LPRgNCw0YLRjCDRgiDQuiDRgNC10LrRg9GA0YHQuNGPINC90LUg0L7RgdGC0LDQvdCw0LLQu9C40LLQsNC10YLRgdGPXHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZ2FtZUxvb3AsYW5pbWF0aW9uVGltZS1sZXZlbE9mQ29tcGxleGl0eSk7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIGdhbWVPdmVyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgfSwxMDApOyAgICBcclxufTtcclxuXHJcbm1lbnUoKTsiXX0=
